<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">


    <context:component-scan base-package="de.ctdo.ldapservice">
        <context:exclude-filter expression="org.springframework.stereotype.Controller" type="annotation"/>
    </context:component-scan>

    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <array>
                <!-- To use the LDAP you have to supply a bind cn and password
                     these are obviously not in the source code and getting via a
                     command line parameter into the context.
                     The file contains:
                       ldap.userDn=cn=s****e,ou=admins,dc=chaostreff-dortmund,dc=de
                       ldap.secret=s********e

                     The file is set by a jetty parameter:
                       -Dldapregconfigpath=/etc/jetty/ldapreg.properties

                     We are using the little detour via that file to avoid having username
                     and password in the process parameter visible via "ps ax".
                     The file should be readable by jetty only.
                     -->
                <value>file:#{systemProperties.ldapregconfigpath}</value>
                <value>classpath:ldapservice.properties</value>
            </array>
        </property>
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
    </bean>


    <bean id="contextSource" class="org.springframework.ldap.core.support.LdapContextSource">
        <property name="url" value="${ldap.url}"/>
        <property name="base" value="${ldap.base}"/>
        <property name="userDn" value="${ldap.userDn}"/>
        <property name="password" value="${ldap.secret}"/>
    </bean>

    <bean id="ldapTemplate" class="org.springframework.ldap.core.LdapTemplate">
        <constructor-arg ref="contextSource"/>
    </bean>

    <bean id="validator" class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"/>


    <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
        <property name="host" value="${emailHost}"/>
    </bean>

    <bean id="templateMessage" class="org.springframework.mail.SimpleMailMessage"
            p:from="${emailFrom}" p:subject="${emailSubject}"
            p:to="${emailTo}"/>


</beans>
